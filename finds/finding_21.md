## æ ‡é¢˜
`minter::calculate_rebase_gauge` å‡½æ•°ä¸­é”™è¯¯çš„å•ä½æ¢ç®—å¯¼è‡´ä¼šè®¡ç³»ç»Ÿå´©æºƒ ğŸš¨

## åˆ†ç±»
Loss / Invariant-Broken â€“ Mis-measurement

## ä½ç½®
- `sources/minter.move`: `calculate_rebase_gauge` å‡½æ•° (L270-L309)

## äºŒçº§æŒ‡æ ‡ä¸å½±å“
- **äºŒçº§æŒ‡æ ‡**: `rebase` å’Œ `gauge` emission çš„åˆ†å‰²æ¯”ä¾‹ã€‚
- **æ ¸å¿ƒæ–­è¨€**: `Invariant-Broken`ã€‚åè®®çš„æ ¸å¿ƒä¼šè®¡ä¸å˜é‡â€”â€”å³èµ„äº§ï¼ˆé“¸é€ çš„ä»£å¸ï¼‰å¿…é¡»ç­‰äºè´Ÿå€ºï¼ˆæ‰¿è¯ºåˆ†é…çš„å¥–åŠ±ï¼‰â€”â€”è¢«å½»åº•ç ´åã€‚
- **å½±å“é—¨æ§›**: `Loss` / `DoS`ã€‚æ­¤ç¼ºé™·å¯¼è‡´ `voter` å’Œ `fee_distributor` æ¨¡å—è®°ä¸‹å¤©é‡çš„è™šå‡è´Ÿå€ºï¼Œè¿œè¶…å®é™…é“¸é€ çš„èµ„äº§ï¼Œæœ€ç»ˆå°†å¯¼è‡´æ‰€æœ‰å¥–åŠ±ç”³é¢†äº¤æ˜“å¤±è´¥ï¼Œä½¿åè®®æ ¸å¿ƒç»æµæ¿€åŠ±åŠŸèƒ½é™·å…¥æ°¸ä¹…æ€§æ‹’ç»æœåŠ¡ã€‚

## è¯¦ç»†è¯´æ˜

### è§¦å‘æ¡ä»¶ / è°ƒç”¨æ ˆ
1.  æ¯å‘¨æ—¶é—´çª—å£åˆ‡æ¢æ—¶ï¼Œä»»ä½•ç”¨æˆ·è°ƒç”¨ `voter::update_period()`ã€‚
2.  `voter` æ¨¡å—è°ƒç”¨ `friend` å‡½æ•° `minter::calculate_rebase_gauge()` æ¥è·å–å½“å‘¨çš„ `rebase` å’Œ `gauge` emission åˆ†é…é¢ã€‚

### ç¼ºé™·åˆ†æ
`calculate_rebase_gauge` å‡½æ•°åœ¨è®¡ç®— `rebase` æ¯”ä¾‹æ—¶ï¼Œå­˜åœ¨ä¸€ä¸ªç¾éš¾æ€§çš„å•ä½æ¢ç®—é”™è¯¯ï¼š

```283:291:sources/minter.move
let ve_supply = (voting_escrow::total_supply(timestamp::now_seconds()) as u256);
let dxlyn_supply = (dxlyn_coin::total_supply() as u256);

let rebase = if (ve_supply <= 0 || dxlyn_supply <= 0) {
    0
}else {
    // ...
    let diff_scaled = AMOUNT_SCALE - (ve_supply / dxlyn_supply);
```
- **L283**: `ve_supply` ä» `voting_escrow` è·å–ï¼Œå…¶ç²¾åº¦ä¸º `10^12`ã€‚
- **L284**: `dxlyn_supply` ä» `dxlyn_coin` è·å–ï¼Œå…¶ç²¾åº¦ä¸º `10^8`ã€‚
- **L291**: ä»£ç åœ¨æœªè¿›è¡Œä»»ä½•ç²¾åº¦è°ƒæ•´çš„æƒ…å†µä¸‹ï¼Œç›´æ¥å°† `ve_supply` é™¤ä»¥ `dxlyn_supply`ã€‚

**æ¼æ´æ ¸å¿ƒ**:
ç”±äºç²¾åº¦å·®å¼‚ï¼Œ`ve_supply / dxlyn_supply` çš„è®¡ç®—ç»“æœä¼šæ¯”å®é™…çš„ "é”ä»“ç‡" å¤§ `10^4` å€ã€‚
- **ç¤ºä¾‹**: å‡è®¾ veDXLYN çš„æ€»ä¾›åº”é‡æ˜¯ DXLYN æ€»ä¾›åº”é‡çš„ 1% (å³ `ve_supply / dxlyn_supply` çš„çœŸå®æ¯”ç‡åº”ä¸º 0.01)ã€‚ç”±äºå•ä½é”™è¯¯ï¼Œè®¡ç®—ç»“æœå°†æ˜¯ `0.01 * 10^4 = 100`ã€‚
- **æ•´æ•°ä¸‹æº¢**: `diff_scaled` çš„è®¡ç®— `AMOUNT_SCALE - (ve_supply / dxlyn_supply)` (å³ `10000 - 100 * 10000` in ratio) ä¼šå˜æˆä¸€ä¸ªå·¨å¤§çš„è´Ÿæ•°ï¼Œç”±äº `u256` çš„ä¸‹æº¢ï¼Œå®ƒä¼š wrap around å˜æˆä¸€ä¸ªæ¥è¿‘ `MAX_U256` çš„æå¤§æ­£æ•°ã€‚
- **å¤©é‡ `rebase`**: éšåçš„ `factor` å’Œ `rebase` è®¡ç®— (L294, L297) ä¼šæ»šé›ªçƒèˆ¬åœ°äº§ç”Ÿä¸€ä¸ªå¤©æ–‡æ•°å­—ã€‚
- **å¤©é‡ `gauge`**: `gauge = weekly_emission - rebase` (L300) åŒæ ·ä¼šå› ä¸‹æº¢è€Œå˜æˆä¸€ä¸ªå¤©æ–‡æ•°å­—ã€‚
- **é”™è¯¯çš„è¿”å›å€¼**: å‡½æ•°æœ€ç»ˆå°†è¿™ä¸¤ä¸ªä¸åˆé€»è¾‘çš„ã€å·¨å¤§çš„ `rebase` å’Œ `gauge` å€¼è¿”å›ç»™ `voter` æ¨¡å—ã€‚

### ç³»ç»Ÿæ€§å´©æºƒ
`voter` æ¨¡å—æ¥æ”¶åˆ°è¿™ä¸¤ä¸ªå€¼åï¼Œä¼šï¼š
1.  å°†å¤©é‡çš„ `gauge` å€¼ç”¨äºæ›´æ–°å…¶å†…éƒ¨çš„å¥–åŠ± `index`ï¼Œä»è€Œå‡­ç©ºåˆ›é€ å‡ºå·¨é¢çš„è´Ÿå€ºã€‚
2.  è°ƒç”¨ `fee_distributor::burn_rebase`ï¼Œè™½ç„¶å®é™…è½¬è´¦çš„ä»£å¸æ•°é‡å—é™äº `minter` å®é™…é“¸é€ çš„ `weekly_emission`ï¼Œä½† `fee_distributor` çš„å†…éƒ¨ä¼šè®¡åŒæ ·ä¼šè¢«é”™è¯¯çš„ `rebase` å€¼æ±¡æŸ“ã€‚

æœ€ç»ˆï¼Œ`voter` å’Œ `fee_distributor` ä¸¤ä¸ªæ ¸å¿ƒåˆ†è´¦æ¨¡å—çš„è´Ÿå€ºï¼ˆå¯¹ç”¨æˆ·çš„å¥–åŠ±æ‰¿è¯ºï¼‰å°†è¿œè¿œè¶…è¿‡å®ƒä»¬å®é™…æ‹¥æœ‰çš„èµ„äº§ã€‚å½“ç”¨æˆ·å°è¯• `claim` æˆ– `get_reward` æ—¶ï¼Œäº¤æ˜“å°†å› èµ„äº§ä¸è¶³è€Œå¤±è´¥ï¼Œå¯¼è‡´æ•´ä¸ªä»£å¸ç»æµæ¿€åŠ±ç³»ç»Ÿç˜«ç—ªã€‚

### è¯æ® (P1-P3)
-   **äº¤æ˜“åºåˆ— (P1)**:
    1.  `voter::update_period()` è¢«è°ƒç”¨ã€‚
    2.  `minter::calculate_rebase_gauge()` è¿”å› `rebase` å’Œ `gauge` çš„å¤©é‡æ•°å€¼ã€‚
    3.  `voter` å†…éƒ¨ `index` è¢«é”™è¯¯æ›´æ–°ï¼Œ`fee_distributor` çš„ä¼šè®¡è¢«æ±¡æŸ“ã€‚
    4.  åç»­æ‰€æœ‰ `fee_distributor::claim` å’Œ `gauge::get_reward` è°ƒç”¨éƒ½å°†å¤±è´¥ã€‚

-   **å˜é‡å‰å (P2)**:
    *   `ve_supply / dxlyn_supply`: `~0.01 * 10^12` / `~1 * 10^8` â†’ `~100` (åº”ä¸º `~0.01`)
    *   `rebase`: `~weekly_emission * 0.3` â†’ `MAX_U64`
    *   `gauge`: `~weekly_emission * 0.7` â†’ `MAX_U64`
    *   `voter.index`: `N` â†’ `N + (MAX_U64 / total_weight)` (å‰§å¢)

-   **å½±å“é‡åŒ– (P3)**:
    *   **DoS**: æ•´ä¸ª rebase å’Œ gauge å¥–åŠ±åˆ†å‘ç³»ç»Ÿå°†æ°¸ä¹…æ€§ç˜«ç—ªã€‚
    *   **Loss**: è™½ç„¶æ²¡æœ‰ç›´æ¥çš„ä»£å¸è¢«ç›—ï¼Œä½†æ‰€æœ‰åº”å‘æ”¾ç»™ veNFT æŒæœ‰è€…å’ŒæµåŠ¨æ€§æä¾›è€…çš„å¥–åŠ±éƒ½å°†æ— æ³•é¢†å–ï¼Œæ„æˆäº‹å®ä¸Šçš„ 100% èµ„é‡‘æŸå¤±ã€‚

## æ ¹å› æ ‡ç­¾
-   `Mis-measurement`
-   `Invariant-Broken`
-   `Systemic Failure`

## çŠ¶æ€
Confirmed
