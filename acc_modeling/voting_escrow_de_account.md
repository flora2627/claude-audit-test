# voting_escrow æ¨¡å—å¤å¼è®°è´¦åˆ†æ

## æ¨¡å—æ¦‚è¿°
voting_escrowç®¡ç†DXLYNçš„é”ä»“å’ŒveNFTçš„å‘è¡Œ/é”€æ¯,æ¯ä¸ªå‡½æ•°éƒ½æ¶‰åŠèµ„äº§(supply)å’Œè´Ÿå€º(locked)çš„åŒæ­¥å˜æ›´ã€‚

---

## ğŸ“Œ voting_escrow@create_lock_internal

### ğŸ§¾ å˜é‡å˜åŠ¨è¡¨

| å˜é‡å | æ–¹å‘(å€Ÿ/è´·) | ä¼šè®¡ç§‘ç›®ç±»åˆ« | è§£é‡Š(ä¸ºä»€ä¹ˆå˜åŠ¨) |
|--------|-------------|--------------|------------------|
| `voting_escrow.supply` | å€Ÿ(å¢åŠ ) | èµ„äº§ | æ¥æ”¶ç”¨æˆ·é”ä»“çš„DXLYN,èµ„äº§æ€»é¢å¢åŠ  |
| `voting_escrow.locked[new_nft]` | è´·(å¢åŠ ) | è´Ÿå€º | ä¸ºæ–°NFTè®°å½•é”ä»“å€ºåŠ¡,amount=value, end=unlock_time |
| åˆçº¦DXLYNä½™é¢ | å€Ÿ(å¢åŠ ) | å®é™…èµ„äº§ | ç”¨æˆ·transfer DXLYNåˆ°voting_escrowåœ°å€ |
| ç”¨æˆ·DXLYNä½™é¢ | è´·(å‡å°‘) | å¤–éƒ¨èµ„äº§ | ç”¨æˆ·æ”¯ä»˜DXLYN(deposit_for_internal L1689) |

### âš–ï¸ å‡½æ•°ä¼šè®¡å¹³è¡¡å¼

```
å€Ÿæ–¹: Î”supply + Î”åˆçº¦DXLYNä½™é¢ = value
è´·æ–¹: Î”locked[new_nft].amount + Î”ç”¨æˆ·DXLYN = value
```

**ä¼šè®¡å¹³è¡¡**: âœ… 
- èµ„äº§å¢åŠ  = è´Ÿå€ºå¢åŠ  = value
- å®é™…DXLYNæµå…¥ = è´¦é¢è®°å½•

**è°ƒç”¨é“¾**:
1. `create_lock()` â†’ `create_lock_internal()` L1376-1408
2. `mint_nft()` L1389 - åˆ›å»ºveNFT
3. `deposit_for_internal()` L1391 - æ›´æ–°supplyå’Œlocked
4. `check_point_internal()` L1674 - æ›´æ–°point_history
5. `primary_fungible_store::transfer()` L1689 - å®é™…è½¬è´¦

---

## ğŸ“Œ voting_escrow@increase_amount

### ğŸ§¾ å˜é‡å˜åŠ¨è¡¨

| å˜é‡å | æ–¹å‘(å€Ÿ/è´·) | ä¼šè®¡ç§‘ç›®ç±»åˆ« | è§£é‡Š |
|--------|-------------|--------------|------|
| `voting_escrow.supply` | å€Ÿ(å¢åŠ ) | èµ„äº§ | è¿½åŠ é”ä»“,èµ„äº§å¢åŠ  |
| `locked[token].amount` | è´·(å¢åŠ ) | è´Ÿå€º | è¯¥NFTçš„é”ä»“å€ºåŠ¡å¢åŠ  |
| åˆçº¦DXLYNä½™é¢ | å€Ÿ(å¢åŠ ) | å®é™…èµ„äº§ | æ¥æ”¶ç”¨æˆ·è¿½åŠ çš„DXLYN |
| ç”¨æˆ·DXLYNä½™é¢ | è´·(å‡å°‘) | å¤–éƒ¨èµ„äº§ | ç”¨æˆ·æ”¯ä»˜è¿½åŠ çš„DXLYN |

### âš–ï¸ å‡½æ•°ä¼šè®¡å¹³è¡¡å¼

```
å€Ÿæ–¹: Î”supply + Î”åˆçº¦ä½™é¢ = value
è´·æ–¹: Î”locked[token].amount + Î”ç”¨æˆ·DXLYN = value
```

**ä¼šè®¡å¹³è¡¡**: âœ… ä¸create_lockç›¸åŒçš„å¹³è¡¡é€»è¾‘

**è°ƒç”¨é“¾**: L466-496, `deposit_for_internal()` L1658å¢åŠ locked.amountå’Œsupply

---

## ğŸ“Œ voting_escrow@increase_unlock_time

### ğŸ§¾ å˜é‡å˜åŠ¨è¡¨

| å˜é‡å | æ–¹å‘(å€Ÿ/è´·) | ä¼šè®¡ç§‘ç›®ç±»åˆ« | è§£é‡Š |
|--------|-------------|--------------|------|
| `locked[token].end` | è´·(å¢åŠ ) | è´Ÿå€ºæœŸé™ | å»¶é•¿é”ä»“åˆ°æœŸæ—¶é—´,è´Ÿå€ºæœŸé™å»¶é•¿ |
| `supply` | å¹³(ä¸å˜) | èµ„äº§ | åªå»¶é•¿æ—¶é—´,ä¸å¢åŠ amount,supplyä¸å˜ |
| `user_point_history[token]` | è´·(å¢åŠ ) | è¡ç”Ÿè´Ÿå€º | å»¶é•¿endå¯¼è‡´biaså¢åŠ (voting powerå¢åŠ ) |

### âš–ï¸ å‡½æ•°ä¼šè®¡å¹³è¡¡å¼

```
å€Ÿæ–¹: 0 (æ— èµ„äº§å˜åŠ¨)
è´·æ–¹: 0 (æ— é‡‘é¢å˜åŠ¨,ä»…æ—¶é—´å±æ€§)
```

**ä¼šè®¡å¹³è¡¡**: âœ… 
- æ— é‡‘é¢å˜åŠ¨,ä»…ä¿®æ”¹è´Ÿå€ºçš„æ—¶é—´å±æ€§
- biaså¢åŠ ä¸å½±å“ä¼šè®¡å¹³è¡¡,å› ä¸ºbiasæ˜¯è®¡ç®—å­—æ®µ,ä¸æ˜¯ç‹¬ç«‹èµ„äº§/è´Ÿå€º

**è°ƒç”¨é“¾**: L505-546, `deposit_for_internal(value=0, unlock_time=æ–°æ—¶é—´)` L529

---

## ğŸ“Œ voting_escrow@merge

### ğŸ§¾ å˜é‡å˜åŠ¨è¡¨

| å˜é‡å | æ–¹å‘(å€Ÿ/è´·) | ä¼šè®¡ç§‘ç›®ç±»åˆ« | è§£é‡Š |
|--------|-------------|--------------|------|
| `locked[from_token].amount` | è´·(å‡å°‘) | è´Ÿå€º | from_tokené”ä»“å½’é›¶,è´Ÿå€ºæ¶ˆå¤± |
| `locked[to_token].amount` | è´·(å¢åŠ ) | è´Ÿå€º | to_tokené”ä»“å¢åŠ ,è´Ÿå€ºå¢åŠ  |
| `supply` | å¹³(å…ˆå‡åå¢) | èµ„äº§ | L595å…ˆå‡value0,L658å†å¢value0,æœ€ç»ˆä¸å˜ |
| `locked[from_token].end` | è´·(å½’é›¶) | è´Ÿå€ºæœŸé™ | from_tokené”ä»“ç»ˆæ­¢ |
| `locked[to_token].end` | è´·(å¯èƒ½å»¶é•¿) | è´Ÿå€ºæœŸé™ | to_tokençš„end=max(from.end, to.end) |

### âš–ï¸ å‡½æ•°ä¼šè®¡å¹³è¡¡å¼

```
å€Ÿæ–¹: 0 (supplyå…ˆ-value0å†+value0,å‡€å˜åŠ¨ä¸º0)
è´·æ–¹: 0 (locked[from]å‡å°‘value0, locked[to]å¢åŠ value0,å‡€å˜åŠ¨ä¸º0)
```

**ä¼šè®¡å¹³è¡¡**: âœ… 
- èµ„äº§ä¸å˜(supplyå…ˆå‡åå¢,L595å’ŒL658)
- è´Ÿå€ºæ€»å’Œä¸å˜(fromå‡toå¢)
- **é£é™©ç‚¹**: L595å‡supplyå’ŒL601 depositä¹‹é—´å¦‚æœrevert,supplyä¼šå°‘!

**è°ƒç”¨é“¾**:
1. L557-611
2. L589 `upsert(from_token, amount=0)` - æ¸…ç©ºfrom
3. L592 `check_point_internal(from_token, old, zero)` - æ›´æ–°checkpoint
4. L595 `supply -= value0` - **å‡supply**
5. L598 `burn_nft(from_token)` - é”€æ¯NFT
6. L601 `deposit_for_internal(to_token, value0, end, MERGE_TYPE)` - **å¢supply** L1658

---

## ğŸ“Œ voting_escrow@split

### ğŸ§¾ å˜é‡å˜åŠ¨è¡¨

| å˜é‡å | æ–¹å‘(å€Ÿ/è´·) | ä¼šè®¡ç§‘ç›®ç±»åˆ« | è§£é‡Š |
|--------|-------------|--------------|------|
| `locked[old_token].amount` | è´·(å½’é›¶) | è´Ÿå€º | åŸNFTé”ä»“å½’é›¶ |
| `locked[new_token_i].amount` | è´·(å¢åŠ ) | è´Ÿå€º | æ¯ä¸ªæ–°NFTæŒ‰æƒé‡åˆ†é…é”ä»“ |
| `supply` | å¹³(å…ˆå‡åå¢) | èµ„äº§ | L647å…ˆå‡value,ç„¶åå¤šæ¬¡depositç´¯åŠ ,æœ€ç»ˆä¸å˜ |

### âš–ï¸ å‡½æ•°ä¼šè®¡å¹³è¡¡å¼

```
å€Ÿæ–¹: 0 (supplyå…ˆ-value,å†+value*weight1/total_weight+value*weight2/total_weight+...,å‡€å˜åŠ¨â‰ˆ0)
è´·æ–¹: 0 (old_lockedå‡value,new_lockedä»¬åŠ æ€»â‰ˆvalue)
```

**ä¼šè®¡å¹³è¡¡**: âš ï¸ **å­˜åœ¨ç²¾åº¦æŸå¤±é£é™©**
- L669 `value * weight / total_weight` çš„é™¤æ³•ä¼šäº§ç”Ÿç²¾åº¦æŸå¤±
- å¦‚æœ`sum(value*weight_i/total_weight) < value`,supplyä¼šè½»å¾®å‡å°‘
- **æ½œåœ¨ä¸å¹³**: lockedæ€»å’Œå¯èƒ½<åŸvalue(dustæŸå¤±)

**è°ƒç”¨é“¾**: L620-692

---

## ğŸ“Œ voting_escrow@withdraw

### ğŸ§¾ å˜é‡å˜åŠ¨è¡¨

| å˜é‡å | æ–¹å‘(å€Ÿ/è´·) | ä¼šè®¡ç§‘ç›®ç±»åˆ« | è§£é‡Š |
|--------|-------------|--------------|------|
| `locked[token].amount` | è´·(å½’é›¶) | è´Ÿå€º | NFTé”ä»“å½’é›¶,è´Ÿå€ºæ¶ˆå¤± |
| `locked[token].end` | è´·(å½’é›¶) | è´Ÿå€ºæœŸé™ | é”ä»“ç»ˆæ­¢ |
| `supply` | è´·(å‡å°‘) | èµ„äº§ | å½’è¿˜DXLYNç»™ç”¨æˆ·,èµ„äº§å‡å°‘ |
| åˆçº¦DXLYNä½™é¢ | è´·(å‡å°‘) | å®é™…èµ„äº§ | è½¬å‡ºDXLYN |
| ç”¨æˆ·DXLYNä½™é¢ | å€Ÿ(å¢åŠ ) | å¤–éƒ¨èµ„äº§ | ç”¨æˆ·æ”¶åˆ°DXLYN |

### âš–ï¸ å‡½æ•°ä¼šè®¡å¹³è¡¡å¼

```
å€Ÿæ–¹: Î”ç”¨æˆ·DXLYN = value
è´·æ–¹: Î”supply + Î”locked[token].amount + Î”åˆçº¦ä½™é¢ = value
```

**ä¼šè®¡å¹³è¡¡**: âœ…
- èµ„äº§å‡å°‘ = è´Ÿå€ºå‡å°‘ = value
- å®é™…DXLYNæµå‡º = è´¦é¢å‡å°‘

**è°ƒç”¨é“¾**: L703-765
- L728 `upsert(token, amount=0, end=0)` - æ¸…ç©ºlocked
- L730 `supply = subtract_or_zero(supply, value)` - å‡supply
- L743 `primary_fungible_store::transfer(to user, value)` - å®é™…è½¬è´¦
- L752 `burn_nft(token)` - é”€æ¯NFT

**é£é™©ç‚¹**: L730ä½¿ç”¨`subtract_or_zero`,å¦‚æœsupply<value,ä¼šå½’é›¶è€Œérevert!

---

## ğŸ“Œ voting_escrow@deposit_for_internal (å†…éƒ¨å…³é”®å‡½æ•°)

### ğŸ§¾ å˜é‡å˜åŠ¨è¡¨

| å˜é‡å | æ–¹å‘(å€Ÿ/è´·) | ä¼šè®¡ç§‘ç›®ç±»åˆ« | è§£é‡Š |
|--------|-------------|--------------|------|
| `supply` | å€Ÿ(å¢åŠ ) | èµ„äº§ | supply += value (L1658) |
| `locked[token].amount` | è´·(å¢åŠ ) | è´Ÿå€º | locked.amount += value (L1662) |
| `locked[token].end` | è´·(å¯èƒ½æ›´æ–°) | è´Ÿå€ºæœŸé™ | å¦‚unlock_time>0,æ›´æ–°end (L1665) |
| åˆçº¦DXLYNä½™é¢ | å€Ÿ(å¯èƒ½å¢åŠ ) | å®é™…èµ„äº§ | å¦‚typeéMERGE/SPLIT,å®é™…è½¬è´¦ (L1689) |

### âš–ï¸ å‡½æ•°ä¼šè®¡å¹³è¡¡å¼

```
å¦‚æœtype=0(normal):
  å€Ÿæ–¹: Î”supply + Î”åˆçº¦ä½™é¢ = value
  è´·æ–¹: Î”locked[token].amount = value

å¦‚æœtype=MERGE/SPLIT:
  å€Ÿæ–¹: Î”supply = value
  è´·æ–¹: Î”locked[token].amount = value
  (æ— å®é™…è½¬è´¦,å› ä¸ºèµ„äº§å·²åœ¨merge/splitä¸­å¤„ç†)
```

**ä¼šè®¡å¹³è¡¡**: âœ…

**ç‰¹æ®Šé€»è¾‘**:
- L1681-1695: type=MERGE/SPLITæ—¶è·³è¿‡transfer,å› ä¸ºèµ„äº§å·²åœ¨è°ƒç”¨æ–¹å¤„ç†
- L1656-1658: supplyå…ˆè¯»å†åŠ ,æ— åŸå­æ€§é—®é¢˜

---

## ğŸ“Œ voting_escrow@check_point_internal (å†…éƒ¨å‡½æ•°)

### ğŸ§¾ å˜é‡å˜åŠ¨è¡¨

| å˜é‡å | æ–¹å‘(å€Ÿ/è´·) | ä¼šè®¡ç§‘ç›®ç±»åˆ« | è§£é‡Š |
|--------|-------------|--------------|------|
| `point_history[epoch]` | è´·(æ›´æ–°) | å…¨å±€æƒé‡è´Ÿå€º | æ›´æ–°å…¨å±€voting powerå¿«ç…§ |
| `user_point_history[token][epoch]` | è´·(æ›´æ–°) | ç”¨æˆ·æƒé‡è´Ÿå€º | æ›´æ–°è¯¥NFTçš„voting powerå¿«ç…§ |
| `slope_changes[timestamp]` | è´·(æ›´æ–°) | æœªæ¥æƒé‡å˜åŠ¨ | è®°å½•æœªæ¥æŸæ—¶åˆ»slopeçš„å˜åŒ– |
| `epoch` | å¢åŠ  | ç´¢å¼• | å…¨å±€epochè®¡æ•°å™¨é€’å¢ |
| `user_point_epoch[token]` | å¢åŠ  | ç´¢å¼• | ç”¨æˆ·epochè®¡æ•°å™¨é€’å¢ |

### âš–ï¸ å‡½æ•°ä¼šè®¡å¹³è¡¡å¼

```
æ— é‡‘é¢å€Ÿè´·
ä»…æ›´æ–°è¡ç”Ÿå­—æ®µ(point, slope)
```

**ä¼šè®¡å¹³è¡¡**: N/A (éé‡‘é¢å˜åŠ¨,æ˜¯æƒé‡é‡æ–°è®¡ç®—)

**å…³é”®é€»è¾‘**:
- L1448-1455: è®¡ç®—oldå’Œnewçš„bias/slope
- L1507-1546: éå†å†å²å‘¨,åº”ç”¨slope_changes,æ›´æ–°point_history
- L1550-1631: æ›´æ–°user_point_historyå’Œslope_changes

**æ— ä¼šè®¡é£é™©**: checkpointæ˜¯çº¯è®¡ç®—,ä¸æ¶‰åŠèµ„äº§è½¬ç§»

---

## ğŸ“Œ voting_escrow@voting (friendå‡½æ•°)

### ğŸ§¾ å˜é‡å˜åŠ¨è¡¨

| å˜é‡å | æ–¹å‘(å€Ÿ/è´·) | ä¼šè®¡ç§‘ç›®ç±»åˆ« | è§£é‡Š |
|--------|-------------|--------------|------|
| `voted[token]` | è´·(è®¾ä¸ºtrue) | è´Ÿå€ºçŠ¶æ€ | æ ‡è®°NFTæ­£åœ¨æŠ•ç¥¨,ç¦æ­¢è½¬ç§»/åˆå¹¶/åˆ†å‰²/æå– |
| NFT transfer_ref | å¹³(disable) | è´Ÿå€ºæ§åˆ¶ | ç¦ç”¨NFTè½¬ç§» |

### âš–ï¸ å‡½æ•°ä¼šè®¡å¹³è¡¡å¼

```
æ— é‡‘é¢å˜åŠ¨,ä»…çŠ¶æ€æ ‡è®°
```

**ä¼šè®¡å½±å“**: 
- voted=trueæ—¶,lockedé‡‘é¢å†»ç»“,æ— æ³•æå–
- è¿™æ˜¯å¯¹è´Ÿå€ºçš„**ä¸´æ—¶é”å®š**,ç¡®ä¿æŠ•ç¥¨æœŸé—´æƒé‡ç¨³å®š

**æƒé™æ£€æŸ¥**: L1342 `assert voter == voting_escrow.voter` (friendè°ƒç”¨)

---

## ğŸ“Œ voting_escrow@abstain (friendå‡½æ•°)

### ğŸ§¾ å˜é‡å˜åŠ¨è¡¨

| å˜é‡å | æ–¹å‘(å€Ÿ/è´·) | ä¼šè®¡ç§‘ç›®ç±»åˆ« | è§£é‡Š |
|--------|-------------|--------------|------|
| `voted[token]` | è´·(è®¾ä¸ºfalse) | è´Ÿå€ºçŠ¶æ€ | è§£é™¤æŠ•ç¥¨æ ‡è®°,å…è®¸è½¬ç§»/åˆå¹¶/åˆ†å‰²/æå– |
| NFT transfer_ref | å¹³(enable) | è´Ÿå€ºæ§åˆ¶ | å¯ç”¨NFTè½¬ç§» |

### âš–ï¸ å‡½æ•°ä¼šè®¡å¹³è¡¡å¼

```
æ— é‡‘é¢å˜åŠ¨,è§£é™¤å†»ç»“
```

**ä¼šè®¡å½±å“**: voted=falseå,lockedé‡‘é¢å¯æå–

---

## ğŸ“Œ voting_escrow@checkpoint (entryå‡½æ•°)

### ğŸ§¾ å˜é‡å˜åŠ¨è¡¨

| å˜é‡å | æ–¹å‘(å€Ÿ/è´·) | ä¼šè®¡ç§‘ç›®ç±»åˆ« | è§£é‡Š |
|--------|-------------|--------------|------|
| `point_history[epoch]` | è´·(æ›´æ–°) | å…¨å±€æƒé‡ | ä»…æ›´æ–°å…¨å±€checkpoint |

### âš–ï¸ å‡½æ•°ä¼šè®¡å¹³è¡¡å¼

```
æ— é‡‘é¢å˜åŠ¨,ä»…å…¨å±€checkpoint
```

**è°ƒç”¨**: L427-433, `check_point_internal(voting_escrow, @0x0, &empty, &empty)`

---

## ä¼šè®¡é£é™©æ±‡æ€»

### ğŸ”´ é«˜é£é™©

#### 1. mergeå‡½æ•°çš„supplyå‡å¢ä¸åŸå­
- **ä½ç½®**: L595 `supply -= value0` å’Œ L658 `supply += value0`
- **é£é™©**: å¦‚æœL598-601ä¹‹é—´revert,supplyä¼šæ°¸ä¹…å‡å°‘value0
- **åœºæ™¯**: burn_nftæˆ–deposit_for_internalå¤±è´¥
- **å½±å“**: èµ„äº§<è´Ÿå€º,supplyä½ä¼°

#### 2. withdrawä½¿ç”¨subtract_or_zero
- **ä½ç½®**: L730 `supply = subtract_or_zero(supply, value)`
- **é£é™©**: å¦‚æœsupply<value(å¼‚å¸¸çŠ¶æ€),ä¼šå½’é›¶è€Œérevert
- **å½±å“**: æ©ç›–ä¼šè®¡é”™è¯¯,supplyå½’é›¶ä½†lockedä»æœ‰è®°å½•

#### 3. splitçš„ç²¾åº¦æŸå¤±
- **ä½ç½®**: L669 `value * weight / total_weight`
- **é£é™©**: é™¤æ³•ç²¾åº¦æŸå¤±å¯¼è‡´sum(æ–°NFT.amount) < åŸvalue
- **å½±å“**: supplyå‡value,ä½†lockedæ€»å’Œå¢åŠ <value,èµ„äº§>è´Ÿå€º,å·®é¢dustæ°¸ä¹…é”å®š

### ğŸŸ¡ ä¸­é£é™©

#### 4. voted=trueæ—¶æ— æ³•æå–
- **ä½ç½®**: L713 `assert !voted`
- **é£é™©**: å¦‚æœvoteråˆçº¦bugå¯¼è‡´æ— æ³•è°ƒç”¨abstain,NFTæ°¸ä¹…æ— æ³•æå–
- **ç¼“è§£**: voteræ¨¡å—æ­£ç¡®å®ç°resetå³å¯

#### 5. Pointè®¡ç®—æº¢å‡º
- **ä½ç½®**: L1448 `u_old.slope = (amount * AMOUNT_SCALE) / MAXTIME`
- **é£é™©**: amountè¿‡å¤§å¯¼è‡´ä¹˜æ³•æº¢å‡º
- **æ£€æŸ¥**: amountæ˜¯u64,AMOUNT_SCALE=10^4,MAXTIME=126144000
  - max_value = 2^64 / 10^4 â‰ˆ 1.8e15,å¯¹åº”1.8e7 DXLYN(1800ä¸‡æš)
  - å•ä¸ªNFTé”ä»“1800ä¸‡æšæ—¶æº¢å‡º
- **ç°å®æ€§**: å¦‚æœtotal supplyæ‰100M,å•NFTä¸å¯èƒ½1800ä¸‡,é£é™©ä½

### ğŸŸ¢ ä½é£é™©

#### 6. Checkpointå»¶è¿Ÿå¯¼è‡´æƒé‡æ»å
- **é£é™©**: ç”¨æˆ·æ“ä½œå,å…¶ä»–ç”¨æˆ·çš„total_supply()æŸ¥è¯¢å¯èƒ½æ»å
- **å½±å“**: fee_distributorå’Œvoterå¯èƒ½ä½¿ç”¨æ—§æƒé‡
- **ç¼“è§£**: æ¯æ¬¡æ“ä½œéƒ½è°ƒç”¨check_point_internal

---

## æ€»ç»“

### æ ¸å¿ƒä¼šè®¡å…¬å¼
```
create/increase: supplyâ†‘ = locked[token].amountâ†‘ = å®é™…DXLYNæµå…¥
withdraw:        supplyâ†“ = locked[token].amountâ†“ = å®é™…DXLYNæµå‡º
merge:           supplyä¸å˜, lockedé‡æ–°åˆ†é…
split:           supplyâ‰ˆä¸å˜(æœ‰ç²¾åº¦æŸå¤±), lockedé‡æ–°åˆ†é…
```

### ä¼šè®¡å¹³è¡¡æ£€æŸ¥æ¸…å•
- [x] create_lock: supplyå¢åŠ =lockedå¢åŠ =å®é™…è½¬å…¥ âœ…
- [x] increase_amount: supplyå¢åŠ =lockedå¢åŠ =å®é™…è½¬å…¥ âœ…
- [x] increase_unlock_time: æ— é‡‘é¢å˜åŠ¨ âœ…
- [âš ï¸] merge: supplyå…ˆå‡åå¢,ä¸­é—´reverté£é™©
- [âš ï¸] split: ç²¾åº¦æŸå¤±å¯¼è‡´supplyå¯èƒ½>lockedæ€»å’Œ
- [âš ï¸] withdraw: subtract_or_zeroæ©ç›–ä¸‹æº¢

### å»ºè®®çš„å®¡è®¡æ£€æŸ¥ç‚¹

1. **æ£€æŸ¥mergeçš„åŸå­æ€§**: L595-601ä¹‹é—´çš„å¼‚å¸¸å¤„ç†
2. **æ£€æŸ¥splitçš„ç²¾åº¦**: æ˜¯å¦æœ‰dustç´¯ç§¯
3. **æ£€æŸ¥withdrawçš„ä¸‹æº¢**: ä¸ºä½•ç”¨subtract_or_zeroè€Œéç›´æ¥å‡æ³•
4. **æ£€æŸ¥supply vs lockedæ€»å’Œ**: å†™invariant testéªŒè¯

